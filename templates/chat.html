<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agent N3sty!</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet">
<style>
  #messages {
    max-height: 400px; /* Fixed height for scroll effect */
    overflow-y: auto;  /* Enables scrolling */
    padding: 10px;
    border: 1px solid #ddd;
    background: #f9f9f9;
  }
  
  #messages li {
    margin-bottom: 20px; /* More space between threads */
  }

  .btn-primary {
    width: 100%; /* Wider button */
    height: 50px; /* Increase height */
  }

  /* Floating scroll-to-bottom button */
  #scrollButton {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #007bff;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 50%;
    cursor: pointer;
    display: none; /* Hidden initially */
    z-index: 1000;
  }

  /* Enhanced styling for autocomplete dropdown */
  .ui-menu-item-wrapper {
    font-size: 16px;
    background: #FFF;
    border-bottom: 1px solid #ddd;
    padding: 10px 10px;
    color: #333;
    line-height: 24px;
  }
</style>
</head>
<body>

<div class="container">
  <div class="row mt-5">
    <div class="col-md-6 offset-md-3">
        <h3 class="mb-4 text-center"><s>GPT-2 Pre-Trained</s></h3>
        <h2 class="mb-4 text-center">Agent Nesty!</h2>
        <ul id="messages" class="list-unstyled" style="display:none"></ul>
        <form id="form" action="/get_response" method="post">
          <div class="mb-3">
            <input type="text" 
            class="form-control" 
            id="text" name="text" placeholder="Say something..." 
            required>
          </div>
          <div id="spinner" style="display:none; padding: 10px">
            <div class="spinner-border text-primary text-center" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
          <button type="submit" class="btn btn-primary" id="sendButton">Send</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Scroll to Bottom Button -->
<button id="scrollButton">â†“</button>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script>
$(document).ready(function() {
    var commands = ["/wiki", "/info", "/help"]; // Add more predefined commands

    // Autocomplete feature
    $('#text').autocomplete({
      source: commands,
      minLength: 1,
      select: function(event, ui) {
        this.value = ui.item.value + " ";
        return false;
      }
    });

    // Handle form submission
    $('#form').on('submit', function(e) {
        e.preventDefault();
        var text = $('#text').val();
        $('#sendButton').prop('disabled', true); // Disable the button
        $('#spinner').show(); // Show spinner

        $.post('/get_response', {text: text}, function(data) {
            $('#messages').show();
            $('#messages').append('<li><strong>You:</strong> ' + text + '<br><strong>AI:</strong> ' + data.message + '</li>');
            $('#text').val('');
            $('#sendButton').prop('disabled', false); // Enable the button
            $('#spinner').hide(); // Hide spinner

            scrollToBottom(); // Automatically scroll to the latest message
        });
    });

    // Function to scroll to bottom
    function scrollToBottom() {
        var messagesDiv = $('#messages');
        messagesDiv.scrollTop(messagesDiv.prop("scrollHeight"));
    }

    // Show/hide "Scroll to Bottom" button when scrolling
    $('#messages').on('scroll', function() {
        var scrollButton = $('#scrollButton');
        if ($(this).scrollTop() + $(this).innerHeight() < this.scrollHeight) {
            scrollButton.fadeIn();
        } else {
            scrollButton.fadeOut();
        }
    });

    // Scroll to bottom when clicking the button
    $('#scrollButton').on('click', function() {
        scrollToBottom();
    });

    // Initially scroll to bottom in case there are preloaded messages
    scrollToBottom();
});
</script>
</body>
</html>
